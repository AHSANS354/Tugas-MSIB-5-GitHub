3.	Buat fungsi kategori_harga dengan parameter yang menerima inputan argument tipe data double dan mengembalikan tipe data string kategori harga berdasarkan: 

DELIMITER $$

CREATE FUNCTION kategori_harga(harga DOUBLE) RETURNS VARCHAR(255)
BEGIN
    DECLARE kategori VARCHAR(255);
    
    IF harga >= 0 AND harga <= 500000 THEN
        SET kategori = 'murah';
    ELSEIF harga > 500000 AND harga <= 3000000 THEN
        SET kategori = 'sedang';
    ELSEIF harga > 3000000 AND harga <= 10000000 THEN
        SET kategori = 'mahal';
    ELSEIF harga > 10000000 THEN
        SET kategori = 'sangat mahal';
    ELSE
        SET kategori = 'Tidak valid';
    END IF;
    
    RETURN kategori;
END $$

DELIMITER ;

2.	Buatlah Stored Procedure dengan nama kurangi_stok untuk mengurangi stok produk. Stok berkurang sesuai dengan jumlah pesanan produk.

DELIMITER $$

CREATE PROCEDURE kurangi_stok(IN product_id INT, IN order_amount INT)
BEGIN
    DECLARE current_stock INT;
    SELECT stok INTO current_stock FROM produk WHERE id = product_id;
    IF current_stock >= order_amount THEN
        UPDATE produk SET stok = current_stock - order_amount WHERE id = product_id;
    ELSE
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Stok produk tidak mencukupi';
    END IF;
END;

DELIMITER ;

3.	Buatlah Trigger dengan nama trig_kurangi_stok yang akan mengurangi stok produk jika terjadi transaksi pesanan oleh pelanggan (memanggil stored procedure kurangi_stok soal no 1).
Trigger ini aktif setelah trigger after_pesanan_items_insert (trigger pada contoh 3).

DELIMITER $$

CREATE TRIGGER trig_kurangi_stok
AFTER INSERT ON after_pesanan_items_insert
FOR EACH ROW
BEGIN
    DECLARE product_id INT;
    DECLARE order_amount INT;
    
    SET product_id = NEW.produk_id;
    SET order_amount = NEW.jumlah_pesanan;
    
    CALL kurangi_stok(product_id, order_amount);
END $$

DELIMITER ;
